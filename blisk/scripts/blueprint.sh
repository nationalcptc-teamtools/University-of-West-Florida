#!/bin/zsh
echo '
MWWNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNWM
WNNNXKK000KK000000KKKKKK0KKK00KKKKKKKKKKKKK0000KKKKKKKKK0000000KKXNNNW
NNWKdlccclolcccccccllcllccllcccloollllllllccclllllllllllccccccllco0WNN
NNW0l:cok0K0o:::::clcccc::ccccccccccccccclcclccc:cllllllc::cccccclOWNN
NNW0l:cldKNOl:::::clc:cc:::::ccclccccccccccclc::::llllllccccccccccOWNN
NNW0oodolOXxc:::::clc:cc::::::::::::ccccc::ccclccccclllolcccccccclOWNN
NNW0oxKKk0Kdc:::::clcccc:::::::::cccclcccc:::ccccc::llllllcccccccckWNN
NNW0lcok0Okl::::::cllccc:::::::ccloooooooolc:::::::cllc:::ccccc:ccOWNN
NNW0ooOOxk0kl:::::cll:cc:::::ccloollc::::codoc:::cccc::::cccc::cclOWNN
NNW0oONkccOXxc::::clcccc:::ccldol::;;::coxkOkocccccc:::ccccc:clccckWNN
NNW0oxKOdd00o:::::cccccc:ccclodc:::;;;:lO0OO0kocc::::cccc::::llc:ckWNN
NNW0lcokOOkdlc:::::::::cccccodc:::::;;:cx00Okoc::::cccc::::::llccckWNN
NNW0ooOKkdk0xl::::cloodddolodc::::::::::cdkxdoooooolc::::::::looooOWNN
NNW0lcONK0Kxl:::coddddddddxdc::::::::::::cdxddddddxdoc:::::::looooOWNN
NNW0lcONKO0Ol::coxdooooooolc::::::::::::::clooooooodxoc::::::lllllkWNN
NNW0oo0XOokXklcoxdoodddoolc::::::;:::;::;::cloodddoodxoc::ccclllllOWNN
NNW0odO0OkO0xllxxodxdoddoc::;::::::cc:::;:::coxdodxdoxxc::clllllloOWNN
NNW0ll0N0xOOdldOkdkkl:lxo:::clodxkkkkxdolc:::oxl:lxkdkkoc:ccccccclOWNN
NNW0lcON0xxoccx0OOOOocodc::coxkOOOOOOOOkxoc::cdocoOOOOOxc::::::::ckWNN
NNW0ll0NkoxkocldkOxoclxo::lod:::xO00Okk:::llc:oxlcoxkkdl:::::::::ckWNN
NNW0odO0OO0Oo::cclc::ldocldxkxxxxOOOOkOOdoxkdcodl::cllcccccccccccckWNN
NNW0ooOKOxOOo::::::::cdxdd:kOkkkkOOOkkkOOOO:kkxxoc::cllllldkxodOOdoOWN
NNW0lcONkoO0dc:::::ccokkxd::::::::::::::::::ook0Oxl::clllllKk0N0doOWNN
NNW0lcON0OKOl::::cccccoxxxoc::cloooooolc::cdOOkdc::cllclld00k0NOlo0WNN
NNW0ooOKxlO0d::cccc:::cldkkdl::dO0000Od::lkOOdl::::clc::cd0kokN0ll0WNN
NNW0lcllccooccccc:::::ccoxkxxo::::::::::dkOOxolcc::llc:::lxOOO0Odo0WNN
NNW0lc:::cllclc::cclodddddddxkkxddddddxkkkkxxdxddololc:::oOkxOKOoo0WNN
NNWOlcccccllllcloddddddooddxxxxxkkkkkkxxxddxxdddddxxxolc:coooONOcl0WNN
NNWOllllclollloddoooodddxxxxdoooddxxxxdoodddxxxxxdddddxoccdxx0NOcl0WNN
NNWkccll:clloxxdllodddxxxddooooddddddxxdooooddddxxxdoodxddOkxOKOoo0WNN
NNWkccll:cllokxlccclodxxdooooollcccccloddooooddddolcccoxxxOkdk0Odo0WNN
NNWkccll:clloxdlcccloxxdoooolcc:cllllccclooooodxdolcccodoxK0x0NOll0WNN
NNWkc:ll:clloxdccodoooxxololc:cloooooolc:coooodxooodxkOdccd0KXNOcl0WNN
NNWkccll:clloxdlodoc:lxxoolc:codl::::ldoccclooxxl:coOK0xld00k0N0ol0WNN
NNWkccll:cllllloolc::ldxollcloocc::::ccoolclloxdl::lddocldxdxOOxoo0WNN
NNWkccll:cllll:::::::cxOOdoool::::::::::coddlcddc::llc:::lxOkkOxll0WNN
NNWkc:ll:cllll:::::::cx0K0klc:::::::::::::odolodc::llc:::xXOlckXko0WNN
NNWOlcllccllllcccccccclddolcccccccccccc:::clodolcccclc:::dK0olOKxo0WNN
NNWOolllllllllllllllllllcccclllllllllllcccclccccccclcccc:cokkkkdcl0WNN
NNW0doolllolllllcccllooccodddddollllllcllcc::::::::ccllccclxOO0klo0WNN
NNW0oolllcllllc:::::cllllloodddolllllllooc:::::::::::llcclkX0dk0xoWNN
NNWOlllllcllll:::::::clllllloooollllllodolc:::::::::cllc:cxN0lcccl0WNN
NNWOlllllcllllc::::::clllllllccllllllcloollcccccccllccc::o0NXOoc:l0WNN
NNWOlllllcllcccccccccccclllllccllllllcc:::c::c:::cc::::::ldddoccco0WNN
NNWXOkxdxxxxxxdxxxxxxxxkkxxxxxxxxxkkkkxdddddddddddddddddddddddddxONWNN
MNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNWM
MMWWNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNWMMM
'
echo " "
echo "Starting Active Directory environment setup, optimized for Kali Linux..."
echo " "
echo "1. Updating package lists and installing core dependencies..."
sudo DEBIAN_FRONTEND=noninteractive apt update -y -qq > /dev/null 2>&1
sudo DEBIAN_FRONTEND=noninteractive apt install -y -qq masscan cifs-utils > /dev/null 2>&1
echo "   -> Essential tools (masscan, cifs-utils) installed."
echo "2. Installing 'uv' package manager and updating PATH."
curl -LsSf https://astral.sh/uv/install.sh | sh > /dev/null 2>&1
export PATH="$HOME/.local/bin:$PATH"
echo 'export PATH="$HOME/.local/bin:$PATH"' >> ~/.zshrc
echo "   -> Installing Python-based Active Directory tools via uv (NetExec, Certipy, Impacket, etc.)."
uv tool install git+https://github.com/Pennyw0rth/NetExec.git -q
uv tool install git+https://github.com/ly4k/Certipy.git -q
uv tool install git+https://github.com/fortra/impacket.git -q
uv tool install git+https://github.com/CravateRouge/bloodyAD.git -q
uv tool install git+https://github.com/dirkjanm/BloodHound.py.git@bloodhound-ce -q
uv tool install git+https://github.com/adityatelange/evil-winrm-py -q
echo "   -> Python AD tools installed."
echo "3. Installing BloodHound Community Edition (CE) from apt."
sudo DEBIAN_FRONTEND=noninteractive apt install -y -qq bloodhound > /dev/null 2>&1
echo "   -> BloodHound package installed."
echo "   -> Running BloodHound configuration script (initializing Neo4j and PostgreSQL)..."
sudo bloodhound-setup
echo "   -> BloodHound services (Neo4j, PostgreSQL) initialized and running on http://localhost:7474."
echo "   -> ⚠️ ACTION REQUIRED FOR BLOODHOUND ⚠️"
echo "      1. Open http://localhost:7474."
echo "      2. Log in with the default Neo4j credentials: user: neo4j / password: neo4j."
echo "      3. **Change the default password** when prompted."
echo "      4. **IMPORTANT:** After changing the Neo4j password, you **must** update the BloodHound API config file with the new password: **sudo vim /etc/bhapi/bhapi.json**"
echo "4. Configuring Zsh shell with Oh My Zsh and plugins."
sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh) --unattended" >/dev/null 2>&1
git clone -q https://github.com/zsh-users/zsh-autosuggestions.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions
git clone -q https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting
git clone -q https://github.com/zdharma-continuum/fast-syntax-highlighting ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/fast-syntax-highlighting
sed -i 's/^plugins=(git)$/plugins=(git zsh-syntax-highlighting zsh-autosuggestions fast-syntax-highlighting)/' ~/.zshrc
sed -i 's/robbyrussell/minimal/g' ~/.zshrc
echo "   -> Zsh configuration updated with plugins and minimal theme."
echo "5. Downloading RockYou wordlist."
curl -sSLo ~/rockyou.txt https://github.com/brannondorsey/naive-hashcat/releases/download/data/rockyou.txt
echo "   -> rockyou.txt downloaded to home directory."
source ~/.zshrc
echo " "
echo "======================================================================="
echo "SETUP COMPLETE!"
echo "Next Steps:"
echo "1. Complete the BloodHound password setup steps listed above."
echo "2. Run: **sudo bloodhound** to set the final BloodHound web UI admin credentials (user: admin, pass: admin default)."
echo "======================================================================="
